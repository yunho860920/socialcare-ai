<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialCare AI - ë§¤ë‰´ì–¼ ë¹„ì„œ</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* --- ì—…ê³„ í‘œì¤€ ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ë§ --- */
        :root {
            --bg-color: #121212;
            --chat-bg: #1e1e1e;
            --input-bg: #2d2d2d;
            --accent-color: #0052cc;
            --text-color: #e0e0e0;
            --system-msg-color: #b0bec5;
        }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; display: flex; flex-direction: column; height: 100vh; line-height: 1.6; }
        
        /* í—¤ë” */
        header { padding: 15px 20px; background: var(--chat-bg); border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .title { font-weight: 700; font-size: 1.1rem; color: #fff; display: flex; align-items: center; gap: 8px; }
        
        /* ìƒíƒœ ë°°ì§€ */
        #status-badge { font-size: 0.8rem; padding: 4px 10px; border-radius: 20px; background: #333; color: #aaa; border: 1px solid #444; transition: all 0.3s ease; }
        #status-badge.success { background: #1b5e20; color: #a5d6a7; border-color: #2e7d32; }
        #status-badge.error { background: #b71c1c; color: #ffcdd2; border-color: #c62828; }

        /* ì±„íŒ… ì˜ì—­ */
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; scroll-behavior: smooth; }
        
        .message { padding: 12px 18px; border-radius: 12px; max-width: 85%; word-break: break-word; font-size: 0.95rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .system { background: #263238; color: var(--system-msg-color); text-align: center; align-self: center; font-size: 0.85rem; padding: 8px 15px; border-radius: 20px; width: auto; box-shadow: none; }
        .ai { background: #2d2d2d; border-left: 3px solid #4facfe; align-self: flex-start; }
        .user { background: var(--accent-color); color: white; align-self: flex-end; border-bottom-right-radius: 2px; }

        /* ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ ë³´ì • */
        .ai strong { color: #64b5f6; }
        .ai ul, .ai ol { padding-left: 20px; margin: 5px 0; }
        .ai p { margin: 5px 0; }
        .ai h1, .ai h2, .ai h3 { margin: 10px 0 5px 0; font-size: 1.1rem; color: #fff; }

        /* ì…ë ¥ ì˜ì—­ */
        #input-area { padding: 20px; background: var(--chat-bg); border-top: 1px solid #333; display: flex; gap: 10px; }
        input { flex: 1; padding: 15px; border-radius: 10px; border: 1px solid #444; background: var(--input-bg); color: white; font-size: 16px; outline: none; transition: 0.2s; }
        input:focus { border-color: var(--accent-color); }
        input:disabled { background: #1a1a1a; color: #555; cursor: not-allowed; }
        
        button { padding: 0 25px; border-radius: 10px; border: none; background: var(--accent-color); color: white; font-weight: bold; cursor: pointer; transition: 0.2s; white-space: nowrap; }
        button:hover:not(:disabled) { filter: brightness(1.1); }
        button:disabled { background: #444; cursor: not-allowed; opacity: 0.7; }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loader { display: inline-block; width: 10px; height: 10px; border: 2px solid #fff; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; margin-right: 5px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<header>
    <div class="title">ğŸ¤– ìƒë‹´ ë§¤ë‰´ì–¼ ë¹„ì„œ</div>
    <span id="status-badge">â³ ì´ˆê¸°í™” ì¤‘...</span>
</header>

<div id="chat-box">
    </div>

<div id="input-area">
    <input type="text" id="user-input" placeholder="ë§¤ë‰´ì–¼ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤..." disabled>
    <button id="btn-send" disabled>ì „ì†¡</button>
</div>

<script>
    // ==========================================
    // [ì¤‘ìš”] ì—¬ê¸°ì— ì œë¯¸ë‚˜ì´ API í‚¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”
    // ==========================================
    const GOOGLE_API_KEY = "ì—¬ê¸°ì—_API_í‚¤ë¥¼_ì…ë ¥í•˜ì„¸ìš”"; 
    
    // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
    let manualContent = ""; // ë§¤ë‰´ì–¼ ë‚´ìš©ì´ ì €ì¥ë  ë³€ìˆ˜
    let isProcessing = false; // ì¤‘ë³µ ì „ì†¡ ë°©ì§€ í”Œë˜ê·¸

    // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('btn-send');
    const statusBadge = document.getElementById('status-badge');

    // 1. í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ (ì´ˆê¸°í™” ë¡œì§)
    window.addEventListener('DOMContentLoaded', async () => {
        addMessage("system", "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”. manual.txt íŒŒì¼ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...");
        
        try {
            // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•´ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€ (?v=...) -> ë§¤ë‰´ì–¼ ìˆ˜ì • ì‹œ ì¦‰ì‹œ ë°˜ì˜ë¨
            const response = await fetch('manual.txt?v=' + new Date().getTime());
            
            if (!response.ok) throw new Error("íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ");
            
            manualContent = await response.text();
            
            // ë¡œë“œ ì„±ê³µ ì²˜ë¦¬
            statusBadge.textContent = "âœ… ì˜¨ë¼ì¸";
            statusBadge.className = ""; // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±°
            statusBadge.classList.add('success'); // ì„±ê³µ í´ë˜ìŠ¤ ì¶”ê°€
            statusBadge.style.color = "#a5d6a7";
            statusBadge.style.borderColor = "#2e7d32";
            statusBadge.style.background = "#1b5e20";
            
            // ì…ë ¥ì°½ í™œì„±í™”
            userInput.disabled = false;
            sendBtn.disabled = false;
            userInput.placeholder = "ê¶ê¸ˆí•œ ë‚´ìš©ì„ ë¬¼ì–´ë³´ì„¸ìš” (ì˜ˆ: ì•„ë™í•™ëŒ€ íŒë‹¨ ê¸°ì¤€)";
            userInput.focus();

            // ì„±ê³µ ë©”ì‹œì§€ ë° ì¸ì‚¬ë§ (ë”± í•œ ë²ˆë§Œ ì¶œë ¥)
            // ê¸°ì¡´ ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì œê±° (ì„ íƒ ì‚¬í•­)
            chatBox.innerHTML = ''; 
            addMessage("system", "ë§¤ë‰´ì–¼ ë¡œë“œ ì™„ë£Œ! ìƒë‹´ ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.");
            addMessage("ai", "ì•ˆë…•í•˜ì„¸ìš”, ì—°í˜¸ ì„ ìƒë‹˜. **manual.txt** ì§€ì¹¨ì„œë¥¼ ì™„ë²½í•˜ê²Œ ìˆ™ì§€í•œ AI ë¹„ì„œì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?");

        } catch (error) {
            console.error("ë§¤ë‰´ì–¼ ë¡œë“œ ì‹¤íŒ¨:", error);
            statusBadge.textContent = "âŒ íŒŒì¼ ì—†ìŒ";
            statusBadge.className = "";
            statusBadge.classList.add('error');
            addMessage("system", "ğŸš¨ ì˜¤ë¥˜: 'manual.txt' íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
        }
    });

    // 2. ë©”ì‹œì§€ ì „ì†¡ ë¡œì§
    async function sendMessage() {
        const text = userInput.value.trim();
        if (!text || isProcessing) return;

        // UI ì—…ë°ì´íŠ¸
        addMessage("user", text);
        userInput.value = "";
        isProcessing = true;
        userInput.disabled = true;
        sendBtn.disabled = true;
        sendBtn.innerHTML = '<span class="loader"></span> ì²˜ë¦¬ì¤‘';

        try {
            // ì œë¯¸ë‚˜ì´ API í˜¸ì¶œ
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GOOGLE_API_KEY}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            // í•µì‹¬: RAG í”„ë¡¬í”„íŠ¸ ì£¼ì… (ë§¤ë‰´ì–¼ ë‚´ìš© + ì‚¬ìš©ì ì§ˆë¬¸)
                            text: `
### ì—­í•  ###
ë„ˆëŠ” ì•„ë™ë³´í˜¸ì „ë¬¸ê¸°ê´€ì˜ 20ë…„ ì°¨ ë² í…Œë‘ ì‚¬íšŒë³µì§€ì‚¬ì•¼. ì•„ë˜ ì œê³µëœ [ë§¤ë‰´ì–¼ ë‚´ìš©]ì„ ë°”íƒ•ìœ¼ë¡œ ì§ˆë¬¸ì— ëŒ€í•´ í•œêµ­ì–´ë¡œ ëª…í™•í•˜ê³  ì¹œì ˆí•˜ê²Œ ë‹µë³€í•´ì¤˜.

### ë§¤ë‰´ì–¼ ë‚´ìš© (ì ˆëŒ€ì ì¸ ê¸°ì¤€) ###
${manualContent.substring(0, 30000)} 
(ë‚´ìš©ì´ ë„ˆë¬´ ê¸¸ë©´ ì¼ë¶€ë§Œ ì „ì†¡ë¨)

### ì‚¬ìš©ì ì§ˆë¬¸ ###
${text}

### ë‹µë³€ ì§€ì¹¨ ###
1. ìœ„ ë§¤ë‰´ì–¼ ë‚´ìš©ì— ìˆëŠ” ì •ë³´ë§Œìœ¼ë¡œ ë‹µë³€í•´. ì¶”ì¸¡í•˜ì§€ ë§ˆ.
2. ë§¤ë‰´ì–¼ì— ì—†ëŠ” ë‚´ìš©ì´ë©´ "ì£„ì†¡í•©ë‹ˆë‹¤. í•´ë‹¹ ë‚´ìš©ì€ ë§¤ë‰´ì–¼ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."ë¼ê³  ë§í•´.
3. ì „ë¬¸ ìš©ì–´ëŠ” ì‰½ê²Œ í’€ì–´ì„œ ì„¤ëª…í•´ì¤˜.
4. ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ ê°€ë…ì„± ìˆê²Œ ë‹µë³€í•´.
`
                        }]
                    }]
                })
            });

            const data = await response.json();
            
            if (data.error) throw new Error(data.error.message);
            
            // ì•ˆì „í•œ ì‘ë‹µ ì¶”ì¶œ
            let aiResponse = "ë‹µë³€ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                aiResponse = data.candidates[0].content.parts[0].text;
            }
            
            addMessage("ai", aiResponse);

        } catch (error) {
            console.error("API ì˜¤ë¥˜:", error);
            addMessage("system", "âš ï¸ ë‹µë³€ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (API Key ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ í™•ì¸)");
        } finally {
            // ìƒíƒœ ë³µêµ¬
            isProcessing = false;
            userInput.disabled = false;
            sendBtn.disabled = false;
            sendBtn.textContent = "ì „ì†¡";
            userInput.focus();
        }
    }

    // 3. ì±„íŒ… UI ì¶”ê°€ í•¨ìˆ˜ (ë§ˆí¬ë‹¤ìš´ ì§€ì›)
    function addMessage(type, text) {
        const div = document.createElement('div');
        div.className = `message ${type}`;
        
        // AI ë‹µë³€ì¼ ê²½ìš° ë§ˆí¬ë‹¤ìš´ íŒŒì‹±, ê·¸ ì™¸ì—” ì¼ë°˜ í…ìŠ¤íŠ¸
        if (type === 'ai') {
            div.innerHTML = marked.parse(text);
        } else {
            div.textContent = text;
        }
        
        chatBox.appendChild(div);
        
        // ìë™ ìŠ¤í¬ë¡¤
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    // ì—”í„°í‚¤ ì „ì†¡ ì´ë²¤íŠ¸
    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });

    // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    sendBtn.addEventListener('click', sendMessage);

</script>

</body>
</html>
