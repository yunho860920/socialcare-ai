<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialCare AI - ì˜¤ëšœê¸° ë²„ì „</title>
    <style>
        /* ê¹”ë”í•œ ë””ìì¸ & ê°€ë…ì„± ìµœì í™” */
        body { font-family: 'Pretendard', -apple-system, sans-serif; background: #121212; color: #e0e0e0; margin: 0; display: flex; flex-direction: column; height: 100vh; line-height: 1.6; }
        
        /* í—¤ë” */
        header { padding: 15px 20px; background: #1e1e1e; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .title { font-weight: bold; font-size: 1.1rem; color: #fff; }
        #status-badge { font-size: 0.8rem; padding: 4px 10px; border-radius: 12px; background: #333; color: #aaa; transition: 0.3s; }
        #status-badge.ok { background: #1b5e20; color: #a5d6a7; border: 1px solid #2e7d32; }

        /* ì±„íŒ…ì°½ */
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth; }
        
        /* ë©”ì‹œì§€ í’ì„  */
        .message { padding: 15px 20px; border-radius: 18px; max-width: 85%; word-break: break-word; position: relative; }
        .ai { background: #2d2d2d; color: #ececec; align-self: flex-start; border-bottom-left-radius: 4px; border-left: 4px solid #4facfe; }
        .user { background: #0052cc; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .system { background: #263238; color: #b0bec5; font-size: 0.85rem; text-align: center; align-self: center; width: auto; border-radius: 20px; padding: 5px 15px; }
        .error { background: #3d0000; color: #ff8a80; border: 1px solid #8a0000; }

        /* ğŸ“ ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ë§ (ê¸€ì”¨ ì˜ˆì˜ê²Œ) */
        .ai strong { color: #4facfe; font-weight: 700; } /* êµµì€ ê¸€ì”¨ ìƒ‰ìƒ */
        .ai h1, .ai h2, .ai h3 { margin: 10px 0 5px 0; color: #fff; font-size: 1.1em; }
        .ai ul, .ai ol { margin: 5px 0; padding-left: 20px; }
        .ai li { margin-bottom: 4px; }
        .ai p { margin: 0 0 10px 0; }
        .ai p:last-child { margin: 0; }

        /* ì…ë ¥ì°½ */
        #input-area { padding: 20px; background: #1e1e1e; border-top: 1px solid #333; display: flex; gap: 10px; }
        input { flex: 1; padding: 15px; border-radius: 10px; border: 1px solid #444; background: #2d2d2d; color: white; font-size: 16px; outline: none; }
        input:focus { border-color: #4facfe; background: #333; }
        button { padding: 0 25px; border-radius: 10px; border: none; background: #0052cc; color: white; font-weight: bold; cursor: pointer; font-size: 1rem; }
        button:hover { background: #0065ff; }
        button:disabled { background: #444; cursor: not-allowed; }
    </style>
</head>
<body>

<header>
    <span class="title">ğŸ¤– ìƒë‹´ ë§¤ë‰´ì–¼ ë¹„ì„œ</span>
    <span id="status-badge">ğŸ“‚ ë§¤ë‰´ì–¼ ë¡œë”© ì¤‘...</span>
</header>

<div id="chat-box">
    <div class="message system">
        ğŸ’¡ <b>íŒ:</b> ì§ˆë¬¸ì„ êµ¬ì²´ì ìœ¼ë¡œ í•˜ì‹œë©´ ë§¤ë‰´ì–¼ ë‚´ìš©ì„ ë” ì˜ ì°¾ì•„ëƒ…ë‹ˆë‹¤.
    </div>
    <div class="message ai">
        ì•ˆë…•í•˜ì„¸ìš”! <b>ë§¤ë‰´ì–¼(manual.txt)</b> ë‚´ìš©ì„ ì™„ë²½íˆ ìˆ™ì§€í•˜ê³  ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.<br>
        ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì‹œë©´ <b>ë§¤ë‰´ì–¼ì— ìˆëŠ” ë‚´ìš© ê·¸ëŒ€ë¡œ</b> ë‹µë³€í•´ ë“œë¦´ê²Œìš”.
    </div>
</div>

<div id="input-area">
    <input type="text" id="user-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." autofocus>
    <button id="btn-send">ì „ì†¡</button>
</div>

<script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    // UI ìš”ì†Œ
    const chatBox = document.getElementById('chat-box');
    const input = document.getElementById('user-input');
    const btn = document.getElementById('btn-send');
    const statusBadge = document.getElementById('status-badge');

    // í‚¤ ê´€ë¦¬
    const STORAGE_KEY = "SOCIAL_CARE_KEY_V2";
    let apiKey = localStorage.getItem(STORAGE_KEY);
    let manualContent = "";

    // 1. ë§¤ë‰´ì–¼ ë¡œë“œ (ì‹œì‘ ì‹œ ìë™ ì‹¤í–‰)
    async function loadManual() {
        try {
            const res = await fetch('./manual.txt');
            if (res.ok) {
                manualContent = await res.text();
                statusBadge.innerText = "âœ… ë§¤ë‰´ì–¼ ë¡œë“œë¨";
                statusBadge.classList.add("ok");
                console.log("ë§¤ë‰´ì–¼ ë¡œë”© ì™„ë£Œ");
            }
